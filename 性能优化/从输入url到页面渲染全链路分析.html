<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>步骤 | 苏纯的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/randy.jpg">
    <meta name="description" content="前端路上的点点滴滴">
    <meta name="keywords" content="苏纯，苏纯的博客，苏纯的个人博客">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.e65bc892.js" as="script"><link rel="preload" href="/assets/js/2.85e80f7c.js" as="script"><link rel="preload" href="/assets/js/80.c0406a4b.js" as="script"><link rel="prefetch" href="/assets/js/10.2cc7c1b7.js"><link rel="prefetch" href="/assets/js/100.503d6824.js"><link rel="prefetch" href="/assets/js/101.467351b9.js"><link rel="prefetch" href="/assets/js/102.85da88e3.js"><link rel="prefetch" href="/assets/js/103.e80b0a30.js"><link rel="prefetch" href="/assets/js/104.76ce46e4.js"><link rel="prefetch" href="/assets/js/105.b9551c64.js"><link rel="prefetch" href="/assets/js/106.1046dc50.js"><link rel="prefetch" href="/assets/js/107.3711410c.js"><link rel="prefetch" href="/assets/js/108.1baa70fb.js"><link rel="prefetch" href="/assets/js/11.5576952a.js"><link rel="prefetch" href="/assets/js/12.cbc6050f.js"><link rel="prefetch" href="/assets/js/13.3eede3b1.js"><link rel="prefetch" href="/assets/js/14.e2bc046e.js"><link rel="prefetch" href="/assets/js/15.94510f86.js"><link rel="prefetch" href="/assets/js/16.51993914.js"><link rel="prefetch" href="/assets/js/17.fdab191d.js"><link rel="prefetch" href="/assets/js/18.6952ef03.js"><link rel="prefetch" href="/assets/js/19.66a682be.js"><link rel="prefetch" href="/assets/js/20.f1e52e83.js"><link rel="prefetch" href="/assets/js/21.d299cc10.js"><link rel="prefetch" href="/assets/js/22.d045f903.js"><link rel="prefetch" href="/assets/js/23.4b8706c2.js"><link rel="prefetch" href="/assets/js/24.d828a160.js"><link rel="prefetch" href="/assets/js/25.9207a2db.js"><link rel="prefetch" href="/assets/js/26.4dfe712f.js"><link rel="prefetch" href="/assets/js/27.5198e671.js"><link rel="prefetch" href="/assets/js/28.9fb3d91b.js"><link rel="prefetch" href="/assets/js/29.48dd22f8.js"><link rel="prefetch" href="/assets/js/3.c5a6cd19.js"><link rel="prefetch" href="/assets/js/30.604534e0.js"><link rel="prefetch" href="/assets/js/31.0670a7d6.js"><link rel="prefetch" href="/assets/js/32.855f67fe.js"><link rel="prefetch" href="/assets/js/33.b79b25bf.js"><link rel="prefetch" href="/assets/js/34.c70a6892.js"><link rel="prefetch" href="/assets/js/35.74e0fda4.js"><link rel="prefetch" href="/assets/js/36.2f9de622.js"><link rel="prefetch" href="/assets/js/37.2b0a90ff.js"><link rel="prefetch" href="/assets/js/38.88bba1cc.js"><link rel="prefetch" href="/assets/js/39.83d8f1a2.js"><link rel="prefetch" href="/assets/js/4.bc4e02d5.js"><link rel="prefetch" href="/assets/js/40.5f845ce9.js"><link rel="prefetch" href="/assets/js/41.9e101dea.js"><link rel="prefetch" href="/assets/js/42.fdd55e63.js"><link rel="prefetch" href="/assets/js/43.e394ed90.js"><link rel="prefetch" href="/assets/js/44.a36447cd.js"><link rel="prefetch" href="/assets/js/45.a2637689.js"><link rel="prefetch" href="/assets/js/46.4a4b1a79.js"><link rel="prefetch" href="/assets/js/47.02b87045.js"><link rel="prefetch" href="/assets/js/48.a633a822.js"><link rel="prefetch" href="/assets/js/49.4fba2abe.js"><link rel="prefetch" href="/assets/js/5.416fc629.js"><link rel="prefetch" href="/assets/js/50.ece1958a.js"><link rel="prefetch" href="/assets/js/51.08838220.js"><link rel="prefetch" href="/assets/js/52.2c97c109.js"><link rel="prefetch" href="/assets/js/53.d9bed3cc.js"><link rel="prefetch" href="/assets/js/54.f14f894f.js"><link rel="prefetch" href="/assets/js/55.f86d3182.js"><link rel="prefetch" href="/assets/js/56.967c5b4c.js"><link rel="prefetch" href="/assets/js/57.ee31adeb.js"><link rel="prefetch" href="/assets/js/58.e4f97fc3.js"><link rel="prefetch" href="/assets/js/59.ba87c446.js"><link rel="prefetch" href="/assets/js/6.3003f5cf.js"><link rel="prefetch" href="/assets/js/60.0fd687b2.js"><link rel="prefetch" href="/assets/js/61.14c29aa8.js"><link rel="prefetch" href="/assets/js/62.02ed4a84.js"><link rel="prefetch" href="/assets/js/63.4f244790.js"><link rel="prefetch" href="/assets/js/64.90f95442.js"><link rel="prefetch" href="/assets/js/65.6fcecaac.js"><link rel="prefetch" href="/assets/js/66.30dc9e49.js"><link rel="prefetch" href="/assets/js/67.30e77409.js"><link rel="prefetch" href="/assets/js/68.1ae103d0.js"><link rel="prefetch" href="/assets/js/69.2bb1b3ba.js"><link rel="prefetch" href="/assets/js/7.bbe000a8.js"><link rel="prefetch" href="/assets/js/70.e1e9078a.js"><link rel="prefetch" href="/assets/js/71.fb3fb6bc.js"><link rel="prefetch" href="/assets/js/72.d2af19fa.js"><link rel="prefetch" href="/assets/js/73.78deac33.js"><link rel="prefetch" href="/assets/js/74.77e5798c.js"><link rel="prefetch" href="/assets/js/75.74ccbd2e.js"><link rel="prefetch" href="/assets/js/76.0c18d1d7.js"><link rel="prefetch" href="/assets/js/77.b6984bdc.js"><link rel="prefetch" href="/assets/js/78.469bdbcd.js"><link rel="prefetch" href="/assets/js/79.cb7728c0.js"><link rel="prefetch" href="/assets/js/8.3886c466.js"><link rel="prefetch" href="/assets/js/81.1268ffd3.js"><link rel="prefetch" href="/assets/js/82.1c9fd783.js"><link rel="prefetch" href="/assets/js/83.49eb541a.js"><link rel="prefetch" href="/assets/js/84.3a81bdc3.js"><link rel="prefetch" href="/assets/js/85.9a3ca1b0.js"><link rel="prefetch" href="/assets/js/86.50d7abf5.js"><link rel="prefetch" href="/assets/js/87.c857b6fb.js"><link rel="prefetch" href="/assets/js/88.727da12b.js"><link rel="prefetch" href="/assets/js/89.0645d794.js"><link rel="prefetch" href="/assets/js/9.ca7f7cc1.js"><link rel="prefetch" href="/assets/js/90.496a5ff3.js"><link rel="prefetch" href="/assets/js/91.1ed206dd.js"><link rel="prefetch" href="/assets/js/92.ca50f394.js"><link rel="prefetch" href="/assets/js/93.32e5d343.js"><link rel="prefetch" href="/assets/js/94.d217474c.js"><link rel="prefetch" href="/assets/js/95.9cda0ec7.js"><link rel="prefetch" href="/assets/js/96.652ba2c1.js"><link rel="prefetch" href="/assets/js/97.77aee651.js"><link rel="prefetch" href="/assets/js/98.05d8dd2a.js"><link rel="prefetch" href="/assets/js/99.dec73291.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">苏纯的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide.html" class="nav-link">
  导航
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人收藏" class="dropdown-title"><span class="title">个人收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人收藏" class="mobile-dropdown-title"><span class="title">个人收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/个人收藏/好文章.html" class="nav-link">
  好文章
</a></li><li class="dropdown-item"><!----> <a href="/个人收藏/面试好文章.html" class="nav-link">
  面试好文章
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/sc950828" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide.html" class="nav-link">
  导航
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人收藏" class="dropdown-title"><span class="title">个人收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人收藏" class="mobile-dropdown-title"><span class="title">个人收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/个人收藏/好文章.html" class="nav-link">
  好文章
</a></li><li class="dropdown-item"><!----> <a href="/个人收藏/面试好文章.html" class="nav-link">
  面试好文章
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/sc950828" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/html5" class="sidebar-heading clickable"><span>html5</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/css3" class="sidebar-heading clickable"><span>css3</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js" class="sidebar-heading clickable"><span>js</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/ts" class="sidebar-heading clickable"><span>ts</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vue" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/构建" class="sidebar-heading clickable"><span>构建</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/web安全" class="sidebar-heading clickable"><span>web安全</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/性能优化" class="sidebar-heading clickable open"><span>性能优化</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/性能优化/指标和工具.html" class="sidebar-link">指标和工具</a></li><li><a href="/性能优化/渲染优化.html" class="sidebar-link">渲染优化</a></li><li><a href="/性能优化/代码优化.html" class="sidebar-link">代码优化</a></li><li><a href="/性能优化/资源优化.html" class="sidebar-link">资源优化</a></li><li><a href="/性能优化/webpack构建优化.html" class="sidebar-link">webpack 构建优化</a></li><li><a href="/性能优化/传输加载优化.html" class="sidebar-link">传输加载优化</a></li><li><a href="/性能优化/前沿优化方案.html" class="sidebar-link">前沿优化方案</a></li><li><a href="/性能优化/从输入url到页面渲染全链路分析.html" class="active sidebar-link">从输入url到页面渲染全链路分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/性能优化/从输入url到页面渲染全链路分析.html#步骤" class="sidebar-link">步骤</a></li><li class="sidebar-sub-header"><a href="/性能优化/从输入url到页面渲染全链路分析.html#域名解析" class="sidebar-link">域名解析</a></li><li class="sidebar-sub-header"><a href="/性能优化/从输入url到页面渲染全链路分析.html#网络请求" class="sidebar-link">网络请求</a></li><li class="sidebar-sub-header"><a href="/性能优化/从输入url到页面渲染全链路分析.html#服务器处理阶段" class="sidebar-link">服务器处理阶段</a></li><li class="sidebar-sub-header"><a href="/性能优化/从输入url到页面渲染全链路分析.html#页面渲染阶段" class="sidebar-link">页面渲染阶段</a></li><li class="sidebar-sub-header"><a href="/性能优化/从输入url到页面渲染全链路分析.html#缓存常见问题" class="sidebar-link">缓存常见问题</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/app" class="sidebar-heading clickable"><span>app</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/git" class="sidebar-heading clickable"><span>git</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/计算机" class="sidebar-heading clickable"><span>计算机</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/服务器" class="sidebar-heading clickable"><span>服务器</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h2> <p>从用户输入域名到浏览器渲染页面的过程，可以分为以下几个步骤：</p> <ol><li>域名解析</li> <li>网络请求</li> <li>服务器处理</li> <li>浏览器渲染</li></ol> <h2 id="域名解析"><a href="#域名解析" class="header-anchor">#</a> 域名解析</h2> <p>DNS 就是域名系统，作用是将域名解析成对应的 IP 地址。具体的解析过程</p> <ol><li>输入一个 url，首先浏览器会对 url 进行解析，取出主机名</li> <li>接着查找浏览器自身的 DNS 缓存，查到返回对应 IP</li> <li>没有找到，在本机找 Host 文件是否有对应的 IP（host 文件就是域名和 ip 的映射关系表），查到就返回 IP</li> <li>没有的话，本地 DNS 服务器开始查找，向各级的 DNS 服务器（管理方 DNS 服务器、其他 DNS 服务器、顶层 DNS 服务器、根 DNS 服务器）发送查询报文，获取对应的 IP 地址</li></ol> <p>在每次查找的过程中，浏览器，应用程序，DNS 服务器都会对域名进行缓存，如果命中缓存，DNS 会直接返回对应的 IP，没有命中则继续查找相关的域名服务器，寻找 IP。</p> <p>分析可知这个阶段，我们能优化的方法有限，常见的做法有：</p> <ol><li>在 html 文件增加 DNS 缓存标签</li> <li>通过将域名解析到多个 IP，做 DNS 的负载均衡</li></ol> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 会预取g.test.com解析 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>//g.alicdn.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!-- 自动开启DNS解析功能 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>x-dns-prefetch-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>on<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h2 id="网络请求"><a href="#网络请求" class="header-anchor">#</a> 网络请求</h2> <h3 id="网络链接"><a href="#网络链接" class="header-anchor">#</a> 网络链接</h3> <p><img src="https://xiaosu72.oss-cn-shanghai.aliyuncs.com/blog/images/%E6%9C%AA%E5%91%BD%E5%90%8D1623221100.png" alt="image"></p> <h3 id="http-请求过程"><a href="#http-请求过程" class="header-anchor">#</a> http 请求过程</h3> <ol><li>首先如果是第一次请求，域名经过 DNS 服务器解析拿到映射的 IP</li> <li>这里客户端发送 http 报文给对应的服务器，这个过程中要经过应用层、传输层、网络层、数据链路层和物理层对数据报的层层处理</li> <li>客户端和服务器（或代理服务器）进行三次握手建立 TCP 连接</li> <li>然后服务器返回对应的资源给客户端</li> <li>如果是第二次及以上的请求，浏览器或服务器会通过 http 的 header 参数，判断资源是否过期(这里涉及到强缓存，协商缓存)，如果没有过期，则使用缓存，如果过期，就去服务器拿新的资源</li></ol> <h3 id="五层计算机体系模型"><a href="#五层计算机体系模型" class="header-anchor">#</a> 五层计算机体系模型</h3> <p>第二步，这里客户端发送 http 报文给对应的服务器，具体的过程为：</p> <ol><li>首先应用层提供了很多协议，包括：http、ftp、POP3、IMAP，这里浏览器使用的是 http 协议，首先浏览器会在应用层，把请求的数据报按照 http 协议要求的格式，定义一系列请求的字段，推进 TCP 套接字，等待运输层接收。</li> <li>运输层主要的协议有：TCP 和 UDP，运输层拿到数据报以后，会先看是否和目的主机建立连接，如果没有，则进行三次握手，建立 TCP 连接。如果连接成功，会对数据报进一步封装，增加源主机端口号和目的主机端口号，进行差错检测，然后传递到网络层。</li> <li>网络层主要协议有：IP 协议，接收运输层的数据报，然后增加目的主机 IP，封装成一段段符合 IP 协议的 IP 数据报，经过若干个路由到达数据链路层</li> <li>数据链路层有 ARP 协议，可以通过 IP 地址解析目标地址的 mac 地址，通过物理层转发出去，到达目的局域网后，通过广播，被目的主机接收</li></ol> <h3 id="浏览器缓存策略"><a href="#浏览器缓存策略" class="header-anchor">#</a> 浏览器缓存策略</h3> <p>浏览器的缓存策略，有助于提高网页加载速度，减轻服务器压力。</p> <p>缓存分为强缓存和协商缓存。</p> <ol><li><p>当我们输入 url，浏览器会去查看自身是否有缓存，如果没有缓存会直接请求服务器获取资源，并缓存到浏览器一份，返回数据会携带 ETag 字段和 Last-Modified 字段，状态码 200 OK（from memory cache）,其中 ETag 是文件计算的 hash 值，如果文件不发生改变，这个值不会变。Last-Modified 是文件最后的修改时间，如果文件更新或者覆盖就会显示最新的时间</p></li> <li><p>如果浏览器有缓存，此时检查 http 的请求头，看 cache-control、expires 字段，判断是否过了缓存的有效期，如果没有过有效期，则返回 200 状态码和对应的缓存数据。此时命中的是强缓存。</p></li></ol> <ul><li><p>强缓存分为 expires、cache-control 两种，两者同时存在，cache-control 优先级高</p></li> <li><p>expires 是 http1.0 的定义，服务端返回一个绝对的时间 GMT，为过期时间。这就导致如果服务器时间和浏览器时间不一致，可能会使缓存失效。</p></li> <li><p>cache-control 是 http1.1 的定义</p> <ul><li><p>Cache-Control 服务端参数</p> <ul><li>max-age: 在多少秒内有效</li> <li>s-maxage: 就是用于表示 cache 服务器上（比如 cache CDN，缓存代理服务器）的缓存的有效时间的，并只对 public 缓存有效。</li> <li>no-cache：不使用本地强缓存。需要使用缓存协商，先与服务器确认返回的响应是否被更改，如果之前的响应中存在 ETag，那么请求的时候会与服务端验证，如果资源未被更改，则可以避免重新下载。</li> <li>no-store：直接禁止浏览器缓存数据，每次用户请求该资源，都会向服务器发送一个请求，每次都会下载完整的资源。</li> <li>public：可以被所有的用户缓存，包括终端用户和 CDN 等中间代理服务器。</li> <li>private：只能被终端用户的浏览器缓存，不允许 CDN 等中继缓存服务器对其缓存。默认的。</li></ul></li> <li><p>Cache-Control 客户端参数</p> <ul><li>max-stale: 5 表示客户端到代理服务器上拿缓存的时候，即使代理缓存过期了也不要紧，只要过期时间在 5 秒之内，还是可以从代理中获取的。</li> <li>min-fresh: 5 表示代理缓存需要一定的新鲜度，不要等到缓存刚好到期再拿，一定要在到期前 5 秒之前的时间拿，否则拿不到。</li> <li>only-if-cached 这个字段加上后表示客户端只会接受代理缓存，而不会接受源服务器的响应。如果代理缓存无效，则直接返回 504（Gateway Timeout）。</li></ul></li></ul></li></ul> <ol start="3"><li>如果浏览器缓存已过期，就携带请求头字段 If-None-Match 和 If-Modified-Since 去服务器拉取资源，服务器看到这两个字段，发现和当前服务器资源一致，就直接返回缓存和状态码 304。服务器一般会先验证 If-None-Match，如果不变，再去验证 If-Modified-Since。此时命中的是协商缓存。</li></ol> <ul><li>协商缓存分为 If-None-Match/ETag 组合、If-Modified-Since/Last-Modified 组合两种，两者同时存在，If-None-Match/ETag 优先级高。ETag 和 Last-Modified 是在响应头中，If-None-Match 和 If-Modified-Since 是在请求头中，值是对应的 ETag 和 Last-Modified 的值。</li></ul> <h2 id="服务器处理阶段"><a href="#服务器处理阶段" class="header-anchor">#</a> 服务器处理阶段</h2> <p>服务器接收到请求，协商缓存查看资源是否有变化，如果没有变化直接返回缓存资源。</p> <p>这里如果存在代理服务器或者 CDN 节点，那么相当于增加了一个缓存节点，首先请求会转发到最新的 CDN 节点，CDN 节点收到请求后会判断当前资源是否命中协商缓存，如果过期就回源请求最新的资源，如果没有过期就返回缓存资源。</p> <p>CDN 的存在解决了跨地域请求的时延问题；对服务器压力进行了分流。</p> <p>四次挥手：如果请求结束，服务器和客户端进行四次挥手，断开连接。</p> <h2 id="页面渲染阶段"><a href="#页面渲染阶段" class="header-anchor">#</a> 页面渲染阶段</h2> <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7169ac55453c4138a61c1f733524ff5c~tplv-k3u1fbpfcp-watermark.image" alt="image"></p> <ol><li>下载解析 HTML 文件，构建 DOM 树。下载解析 CSS 生成 CSSDOM 树。这两个是并行的。</li> <li>CSSDOM 树构建完成与 DOM 树组合形成 RenderObject 树。</li> <li>根据 render 树布局（Layout），负责各元素尺寸、位置的计算。(涉及到回流)</li> <li>根据 render 树绘制（paint），绘制页面像素信息。(涉及到重绘)</li> <li>浏览器会将各层的信息发送给 GUI，GUI 将各层合成（composite），显示在屏幕上。</li></ol> <h2 id="缓存常见问题"><a href="#缓存常见问题" class="header-anchor">#</a> 缓存常见问题</h2> <h3 id="强缓存-协商缓存区别"><a href="#强缓存-协商缓存区别" class="header-anchor">#</a> 强缓存 协商缓存区别？</h3> <ul><li>强缓存不会发送请求，返回状态码 200</li> <li>协商缓存会发送请求，返回状态码 304</li></ul> <h3 id="强缓存-协商缓存顺序"><a href="#强缓存-协商缓存顺序" class="header-anchor">#</a> 强缓存 协商缓存顺序？</h3> <ul><li>先强缓存 Cache-Control expires</li> <li>再协商缓存 Etag Last-Modified</li></ul> <h3 id="etag-是由什么生成的-与另外一种协商缓存的区别是什么"><a href="#etag-是由什么生成的-与另外一种协商缓存的区别是什么" class="header-anchor">#</a> Etag 是由什么生成的，与另外一种协商缓存的区别是什么?</h3> <ul><li>Etag 是由 Last-Modified 与 Content-Length 计算而成，etag 与 If-None-Match 一起搭配组成协商缓存，这种协商缓存是下面这种协商缓存的升级版，检测时间的同时还检测文件大小，所以更准确。</li> <li>另外一种协商缓存是 Last-Modified 与 If-Modified-Since 搭配组成的协商缓存，这种缓存只根据时间来计算，所以相对不准确，只能应用于秒级别的修改，如果在一秒内修改，检测不到。</li> <li>在性能上，Etag 要逊于 Last-Modified，毕竟 Last-Modified 只需要记录时间，而 Etag 需要服务器通过算法来计算出文件内容的一个 hash 值。</li></ul> <h3 id="如果-http-响应头中-etag-值改变了-是否意味着文件内容一定已经更改"><a href="#如果-http-响应头中-etag-值改变了-是否意味着文件内容一定已经更改" class="header-anchor">#</a> 如果 http 响应头中 ETag 值改变了，是否意味着文件内容一定已经更改？</h3> <p>不一定，因为编辑了文件但是并未修改内容时 Last-Modified 的时间也会发生变化，所以 Etag 会重新生成。</p> <h3 id="http-服务中静态文件的-last-modified-是根据什么生成的"><a href="#http-服务中静态文件的-last-modified-是根据什么生成的" class="header-anchor">#</a> http 服务中静态文件的 Last-Modified 是根据什么生成的？</h3> <p>更新时间</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/性能优化/前沿优化方案.html" class="prev">
        前沿优化方案
      </a></span> <span class="next"><a href="/app/移动开发简介.html">
        移动开发简介
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e65bc892.js" defer></script><script src="/assets/js/2.85e80f7c.js" defer></script><script src="/assets/js/80.c0406a4b.js" defer></script>
  </body>
</html>
