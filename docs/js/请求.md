## XMLHttpRequest 对象

现代浏览器，最开始与服务器交换数据，都是通过 XMLHttpRequest 对象。它可以使用 JSON、XML、HTML 和 text 文本等格式发送和接收数据。

```js
if (window.XMLHttpRequest) {
  // model browser
  xhr = new XMLHttpRequest();
} else if (window.ActiveXObject) {
  // IE 6 and older
  xhr = new ActiveXObject("Microsoft.XMLHTTP");
}
xhr.open("POST", url, true);
xhr.send(data);
xhr.onreadystatechange = function() {
  try {
    // 处理响应
    if (xhr.readyState === 4) {
      // 请求正常
      if (xhr.status === 200) {
        // 处理响应
      } else {
        // 请求遇到一些问题，处理异常
      }
    } else {
      // 还处于未准备好的状态
    }
  } catch (e) {
    // 通信错误的事件中（例如服务器宕机）
    alert("Caught Exception: " + e.description);
  }
};
```

优点：

1. 不重新加载页面的情况下更新网页
2. 在页面已加载后从服务器请求/接收数据
3. 在后台向服务器发送数据。

缺点：

4. 使用起来也比较繁琐，需要设置很多值。
5. 早期的 IE 浏览器有自己的实现，这样需要写兼容代码。

## jQuery ajax

为了更快捷的操作 DOM，并且规避一些浏览器兼容问题，产生了 jQuery。它里面的 AJAX 请求也兼容了各浏览器，可以有简单易用的方法$.get，$.post。简单点说，就是对 XMLHttpRequest 对象的封装。

```js
$.ajax({
  type: "POST",
  url: url,
  data: data,
  dataType: dataType,
  success: function() {},
  error: function() {},
});
```

优点：

1. 对原生 XHR 的封装，做了兼容处理，简化了使用。
2. 增加了对 JSONP 的支持，可以简单处理部分跨域。

缺点：

1. 如果有多个请求，并且有依赖关系的话，容易形成回调地狱。
2. 本身是针对 MVC 的编程，不符合现在前端 MVVM 的浪潮。
3. ajax 是 jQuery 中的一个方法。如果只是要使用 ajax 却要引入整个 jQuery 非常的不合理。

## fetch

Fetch API 提供了一个 JavaScript 接口，用于访问和操作 HTTP 管道的部分，例如请求和响应。它还提供了一个全局 fetch() 方法，该方法提供了一种简单，合理的方式来跨网络异步获取资源。

```js
const url = "https://suchun.vip/";
const options = {
  method: "POST",
  headers: {
    Accept: "application/json",
    "Content-Type": "application/json;charset=UTF-8",
  },
  body: JSON.stringify({
    a: 10,
    b: 20,
  }),
};

fetch(url, options).then((response) => {
  console.log(response.status);
});
```

优点：

1. 浏览器原生支持不需要单独安装
2. 跨域的处理，在配置中添加 mode： 'no-cors'就可以跨域了

缺点：

1. fetch 只对网络请求报错，对 400，500 都当做成功的请求，需要封装去处理
2. fetch 默认不会带 cookie，需要添加配置项，需要添加 credentials 选项。
3. fetch 不支持 abort，不支持超时控制，使用 setTimeout 及 Promise.reject 的实现超时控制并不能阻止请求过程继续在后台运行，造成了流量的浪费。
4. fetch 没有办法原生监测请求的进度，而 XHR 可以。
5. fetch 获取的数据需要自己手动转换，支持以下方法 arrayBuffer()、blob()、json()、text()、formData()
6. fetch 没有请求拦截和响应拦截
7. fetch 批量请求没有原生 api 支持需要借助 Promise.all([])方法

## axios

axios 是一个基于 promise 的 HTTP 库，可以用在浏览器和 node.js 中。它本质也是对原生 XMLHttpRequest 的封装，只不过它是 Promise 的实现版本，符合最新的 ES 规范。

```js
const options = {
  url: "https://suchun.vip/",
  method: "POST",
  headers: {
    Accept: "application/json",
    "Content-Type": "application/json;charset=UTF-8",
  },
  data: {
    a: 10,
    b: 20,
  },
};

axios(options).then((response) => {
  console.log(response.status);
});
```

优点：

1. 从浏览器中创建 XMLHttpRequests
2. 可在 node.js 中使用
3. 支持 Promise API
4. 提供了并发请求的接口，使用 axios.all([])
5. 拦截请求和响应
6. 自动转换请求数据和响应数据
7. 取消请求
8. 自动转换 JSON 数据
9. 客户端支持防御 XSRF

缺点：

1. 只支持现代浏览器.
