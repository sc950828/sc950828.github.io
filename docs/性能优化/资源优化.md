## html css js 资源优化

对于 html css js 资源的优化无非就是两点

1. 减少 http 的请求
2. 减少请求资源的大小

### 减少 http 的请求

对于减少 http 的请求主要是合并请求（把多个小资源请求可以合并成一个请求），图片 logo 使用雪碧图。

### 减少请求资源的大小

对于减少请求资源的大小主要是压缩资源（比如 HTML 使用 Minifier 在线压缩，webpack 也是集成了该工具）

## 图片优化

1. 选择正确的图片格式
2. 使用合适的图片大小
3. 合理适配手机
4. 压缩
5. 优先级
6. 懒加载、预加载

### 选择正确的图片格式

#### jpg

有损压缩，色彩感很好，不支持透明背景。

常用来做 banner 背景图等。

可以使用 [imagemin](https://github.com/imagemin/imagemin)进一步优化 jpg 图片。

#### png

可以有透明背景，但是体积比较大。

常用来做小 logo 小图标的展示。

可以使用 [imagemin-pngquant](https://github.com/imagemin/imagemin-pngquant)进一步优化 png 图片。

#### gif

动图

#### webp

跟 png 同样质量，但是是 jpg 的大小。

新格式的图片，兼容性可能不太好。

### 加载优化

#### 懒加载

延迟图片的加载，在可视范围内再加载图片。

#### 渐进式加载

jpg 图片默认是 Baseline 格式的，加载的时候图片会从上到下慢慢显示出来。

我们可以使用 Progressive 格式的 jpg 图片，这样图片的加载就会是由模糊到清晰，这样用户体验更好。

#### 响应式图片

适配最佳的图片

1. 针对不同 DPR 的屏幕，我们使用不同的倍图。有两倍图三倍图等等。只适用于背景图。

```css
.avatar {
  background-image: url(conardLi_1x.png);
}
@media only screen and (-webkit-min-device-pixel-ratio: 2) {
  .avatar {
    background-image: url(conardLi_2x.png);
  }
}
@media only screen and (-webkit-min-device-pixel-ratio: 3) {
  .avatar {
    background-image: url(conardLi_3x.png);
  }
}
```

2. 使用 -webkit-image-set 只适用于背景图

```css
.div2 {
  background-image: -webkit-image-set(
    url("./images/user.png") 3x,
    url("./images/banner.png") 2x,
    url("./images/avatar.jpg") 1x
  );
  background-size: cover;
}
```

3. 使用 img 标签的 srcset 属性，浏览器会自动根据像素密度匹配最佳显示图片

对于`<img>`，我们还可以使用的一组很好的特性 object-fit 和 object-position。它们可以控制`<img>`的大小和定位，就像 CSS 背景图像。

```html
<img
  src="./images/avatar.jpg"
  srcset="./images/banner.png 2x, ./images/user.png 3x"
  alt="img"
  width="100"
  height="100"
/>
```

4. 使用 JavaScript 拼接图片 url，使用 window.devicePixelRatio 获取设备像素比，遍历所有图片，替换图片地址：

```js
const dpr = window.devicePixelRatio;
const images = document.querySelectorAll("img");
images.forEach((img) => {
  img.src.replace(".", `@${dpr}x.`);
});
```

5. 使用 SVG 图，SVG 的全称是可缩放矢量图（Scalable Vector Graphics）。不同于位图的基于像素，SVG 则是属于对图像的形状描述，所以它本质上是文本文件，体积较小，且不管放大多少倍都不会失真。

## 字体优化

字体未下载完成是，浏览器隐藏或自动降级，导致字体闪烁。就会有这两种情况，FOIT 和 FOUT

### FOIT

字体先看不到然后突然看到

### FOUT

字体先是一种样式然后加载完后又是一种样式

### 解决

使用 font-display

- auto
- block 前三秒不显示，三秒还没下载完就使用默认字体，下载完后使用真正的字体
- swap 先用默认字体，下载完后使用真正的字体
- fallback 前 100 毫秒不显示，三秒内还没下载完就使用默认字体，三秒内下载完就使用真正的字体
- optional 前 100 毫秒不显示，自动判断网络情况，好的话使用真正的字体，差的话使用默认字体
