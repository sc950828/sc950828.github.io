<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>简介 | 苏纯的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/randy.jpg">
    <meta name="description" content="苏纯,汨罗苏纯,苏纯的博客,苏纯的前端博客,苏纯的个人博客,前端开发">
    <meta name="keywords" content="苏纯,苏纯的博客,苏纯的个人博客,苏纯的前端博客,前端博客,前端个人博客,前端开发">
    
    <link rel="preload" href="/assets/css/0.styles.22fcb12a.css" as="style"><link rel="preload" href="/assets/js/app.30255e96.js" as="script"><link rel="preload" href="/assets/js/2.3fe5eade.js" as="script"><link rel="preload" href="/assets/js/18.380e1d86.js" as="script"><link rel="prefetch" href="/assets/js/10.f9319f1a.js"><link rel="prefetch" href="/assets/js/11.7c8892d0.js"><link rel="prefetch" href="/assets/js/12.bfd4ae56.js"><link rel="prefetch" href="/assets/js/13.7cd5e1e8.js"><link rel="prefetch" href="/assets/js/14.d3b58c71.js"><link rel="prefetch" href="/assets/js/15.f086b97c.js"><link rel="prefetch" href="/assets/js/16.07451047.js"><link rel="prefetch" href="/assets/js/17.f91940a4.js"><link rel="prefetch" href="/assets/js/19.8a466c51.js"><link rel="prefetch" href="/assets/js/20.2b44bd04.js"><link rel="prefetch" href="/assets/js/21.3c129053.js"><link rel="prefetch" href="/assets/js/22.9390abbb.js"><link rel="prefetch" href="/assets/js/23.051467ca.js"><link rel="prefetch" href="/assets/js/24.85aedd8a.js"><link rel="prefetch" href="/assets/js/25.a3b61af0.js"><link rel="prefetch" href="/assets/js/26.ff1c92fd.js"><link rel="prefetch" href="/assets/js/27.396c5348.js"><link rel="prefetch" href="/assets/js/28.e3e4164c.js"><link rel="prefetch" href="/assets/js/29.e69ccd94.js"><link rel="prefetch" href="/assets/js/3.11c80b4e.js"><link rel="prefetch" href="/assets/js/30.28a3997f.js"><link rel="prefetch" href="/assets/js/31.e54ed449.js"><link rel="prefetch" href="/assets/js/32.eb4f0da3.js"><link rel="prefetch" href="/assets/js/33.a05772c0.js"><link rel="prefetch" href="/assets/js/34.c74e9e53.js"><link rel="prefetch" href="/assets/js/35.4aff9555.js"><link rel="prefetch" href="/assets/js/36.c743e87e.js"><link rel="prefetch" href="/assets/js/4.9e16ce31.js"><link rel="prefetch" href="/assets/js/5.126b2f5e.js"><link rel="prefetch" href="/assets/js/6.b325cee5.js"><link rel="prefetch" href="/assets/js/7.1419419a.js"><link rel="prefetch" href="/assets/js/8.5b859010.js"><link rel="prefetch" href="/assets/js/9.2337a7ce.js">
    <link rel="stylesheet" href="/assets/css/0.styles.22fcb12a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">苏纯的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide.html" class="nav-link">
  导航
</a></div><div class="nav-item"><a href="https://juejin.cn/user/3403743730867767/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide.html" class="nav-link">
  导航
</a></div><div class="nav-item"><a href="https://juejin.cn/user/3403743730867767/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/HTML" class="sidebar-heading clickable"><span>HTML</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/CSS" class="sidebar-heading clickable"><span>CSS</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/JavaScript" class="sidebar-heading clickable"><span>JavaScript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/ECMAScript" class="sidebar-heading clickable"><span>ECMAScript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/H5" class="sidebar-heading clickable router-link-active open"><span>H5</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/H5/移动端H5网页开发必备知识.html" class="sidebar-link">移动端H5网页开发必备知识</a></li><li><a href="/H5/移动端H5网页开发常见问题汇总.html" class="sidebar-link">移动端H5网页开发常见问题汇总</a></li><li><a href="/H5/移动端开发必备知识-HybridApp.html" class="active sidebar-link">移动端开发必备知识-HybridApp</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/H5/移动端开发必备知识-HybridApp.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/H5/移动端开发必备知识-HybridApp.html#app-的种类" class="sidebar-link">APP 的种类</a></li><li class="sidebar-sub-header"><a href="/H5/移动端开发必备知识-HybridApp.html#app-和-h5-通信" class="sidebar-link">App 和 H5 通信</a></li><li class="sidebar-sub-header"><a href="/H5/移动端开发必备知识-HybridApp.html#后记" class="sidebar-link">后记</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>面试的时候小伙伴们有没有被问到过<code>Hybrid App</code>呢？不得不说了解<code>Hybrid App</code>是我们前端面试中的一个加分项。今天就跟随笔者的步伐让你彻底弄懂<code>Hybrid App</code>，让你就算没做过也能对面试官的问题应答自如。</p> <p>前面笔者已经介绍了  <a href="https://juejin.cn/post/7055267089895915527" target="_blank" rel="noopener noreferrer">移动端 H5 网页开发必备知识<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和<a href="https://juejin.cn/post/7055599228478816270" target="_blank" rel="noopener noreferrer">移动端 H5 网页开发常见问题汇总<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>两篇文章，感兴趣的同学可以看一看。今天这篇文章主要是介绍 Hybrid App 以及 H5 页面是怎么和 App 通信的。</p> <h2 id="app-的种类"><a href="#app-的种类" class="header-anchor">#</a> APP 的种类</h2> <p>看到这好奇宝宝肯定就要问了，什么是 Hybrid App 呢？别急，接下来容笔者一一介绍。</p> <p>App 目前主要分为三类，分为 Web App、Hybrid App、 Native App。</p> <h3 id="web-app"><a href="#web-app" class="header-anchor">#</a> Web App</h3> <p><code>Web App</code>即移动端的网站，将页面部署在服务器上，然后用户使用各大浏览器访问，不是独立 APP，无法安装和发布。<a href="https://main.m.taobao.com/" target="_blank" rel="noopener noreferrer">手机淘宝<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>就是一个最常见的 Web App。</p> <h4 id="优点"><a href="#优点" class="header-anchor">#</a> 优点：</h4> <ol><li>开发成本低，可以跨平台，调试方便。</li> <li>维护成本低 更新无需通知用户，不需要手动升级 无需安装 App，不会占用手机内存。</li></ol> <h4 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点：</h4> <ol><li>无法获取系统级别的通知，提醒，动效等等。</li> <li>用户留存率低 设计受限制诸多 体验较差。</li></ol> <h3 id="native-app"><a href="#native-app" class="header-anchor">#</a> Native App</h3> <p><code>Native App</code>就是我们常说的原生 App 啦，分为 Android 开发和 IOS 开发。Android 基于 Java 语言，底层调用 Goolge 提供的 API，IOS 基于 Objective c 或 Swift，底层调用 Apple 官方提供的 Api。</p> <h4 id="优点-2"><a href="#优点-2" class="header-anchor">#</a> 优点：</h4> <ol><li>直接依托于操作系统,交互性最强,性能最好。</li> <li>功能最为强大,特别是在与系统交互中,几乎所有功能都能实现。</li></ol> <h4 id="缺点-2"><a href="#缺点-2" class="header-anchor">#</a> 缺点</h4> <ol><li>开发成本高，无法跨平台，不同平台 Android 和 iOS 上都要各自独立开发。</li> <li>门槛较高，原生人员有一定的入门门槛，相比广大的前端人员而言较少。更新缓慢，特别是发布应用商店后，需要等到审核周期。维护成本高。</li></ol> <h3 id="hybrid-app"><a href="#hybrid-app" class="header-anchor">#</a> Hybrid App</h3> <p>接下来就是今天的主角啦，<code>Hybrid App(混合应用程序)</code>，主要原理就是将 APP 的一部分需要动态变动的内容通过 H5 来实现，通过原生的网页加载控件 WebView (Android)或 WKWebView（iOS）来加载 H5 页面（以后若无特殊说明，我们用 WebView 来统一指代 android 和 iOS 中的网页加载控件）。这样以来，H5 部分是可以随时改变而不用发版，动态化需求能满足；同时，由于 H5 代码只需要一次开发，就能同时在 Android 和 iOS 两个平台运行，这也可以减小开发成本，也就是说，H5 部分功能越多，开发成本就越小。我们称这种 h5+原生的开发模式为混合开发，采用混合模式开发的 APP 我们称之为混合应用或 Hybrid APP。</p> <p>你可以简单的理解为是 Web App 和 Native App 的杂合体。</p> <h4 id="优点-3"><a href="#优点-3" class="header-anchor">#</a> 优点：</h4> <ol><li>开发成本较低，可以跨平台，调试方便 维护成本低，功能可复用。</li> <li>功能更加完善，性能和体验要比起 web app 好太多，更新较为自由。</li></ol> <h4 id="缺点-3"><a href="#缺点-3" class="header-anchor">#</a> 缺点：</h4> <ol><li>相比原生，性能仍然有较大损耗，不适用于交互性较强的 app。</li></ol> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7b014fd6a8645fca295ac6757d6ffbd~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <p>说到这小伙伴们对 App 种类以及 Hybrid App 是不是有一定的了解了呢。好奇的宝宝又要问了，难道我们嵌入到 App 里面的 H5 页面不需要动态通信的吗？对，是需要的。接下来我们介绍 Hybrid App 和我们的 H5 页面的通信方式。</p> <h2 id="app-和-h5-通信"><a href="#app-和-h5-通信" class="header-anchor">#</a> App 和 H5 通信</h2> <p>通信分为 H5 端调用原生 App 端方法和原生 App 端调用 H5 端方法。App 又分为 IOS 和 Android 两端，他们之间是有区别的，下面我们分开来介绍。</p> <h3 id="app-端调用-h5-端方法"><a href="#app-端调用-h5-端方法" class="header-anchor">#</a> App 端调用 H5 端方法</h3> <p>App 端调用 H5 端的方法，调用的必须是绑定到 window 对象上面的方法。</p> <p>把 say 方法注册到 window 对象上。</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="android-调用-h5-端方法"><a href="#android-调用-h5-端方法" class="header-anchor">#</a> Android 调用 H5 端方法</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> isAutoUser <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> mSpHelper<span class="token punctuation">.</span><span class="token function">getAutoUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 1.Android: loadUrl (Android系统4.4- 支持)</span>
    <span class="token comment">// 该方法的弊端是无法获取函数返回值；</span>
    <span class="token comment">// say 方法是H5端挂载在window对象上的方法。</span>
    mWebView<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">&quot;javascript:say('&quot;</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">&quot;')&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">// 2.Android: evaluateJavascript (Android系统4.4+ 支持)</span>
    <span class="token comment">// 这里着重介绍 evaluateJavascript，这也是目前主流使用的方法。</span>
    <span class="token comment">// 该方法可以在回调方法中获取函数返回值；</span>
    <span class="token comment">// say 方法是H5端挂载在window对象上的方法。</span>
    mWebView<span class="token punctuation">.</span><span class="token function">evaluateJavascript</span><span class="token punctuation">(</span><span class="token string">&quot;javascript:say('&quot;</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">&quot;')&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ValueCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceiveValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">//此处为 js 返回的结果</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 下面这两种通信方式用的不多，这里就不着重介绍了。</span>

    <span class="token comment">// 3.Android: loadUrl (Android系统4.4- 支持)</span>
    <span class="token comment">// 直接打开某网页链接并传递参数，这种也能给H5端传递参数</span>
    <span class="token comment">// mWebView.loadUrl(&quot;file:///android_asset/shop.html?name=&quot; + username);</span>

    <span class="token comment">// 4. Android端还可以通过重写onJsAlert, onJsConfirm, onJsPrompt方法拦截js中调用警告框，输入框，和确认框。</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ios-调用-h5-端的方法"><a href="#ios-调用-h5-端的方法" class="header-anchor">#</a> IOS 调用 H5 端的方法</h4> <p>IOS 使用不同的语言有不同的调用方法。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">// Objective-C</span>
<span class="token comment">// say 方法是H5端挂载在window对象上的方法</span>
<span class="token punctuation">[</span>self<span class="token punctuation">.</span>webView evaluateJavaScript<span class="token operator">:</span>@<span class="token string">&quot;say('params')&quot;</span> completionHandler<span class="token operator">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Swift</span>
<span class="token comment">// say 方法是H5端挂载在window对象上的方法</span>
webview<span class="token punctuation">.</span><span class="token function">stringByEvaluatingJavaScriptFromString</span><span class="token punctuation">(</span><span class="token string">&quot;say('params')&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="h5-端调用-app-端方法"><a href="#h5-端调用-app-端方法" class="header-anchor">#</a> H5 端调用 App 端方法</h3> <p>提供给 H5 端调用的方法，Android 与 IOS 分别拥有对应的挂载方式。分别对应是:<code>苹果 UIWebview JavaScriptCore 注入</code>（这里不介绍）、<code>安卓 addJavascriptInterface 注入</code>、<code>苹果 WKWebView scriptMessageHandler 注入</code>。</p> <h4 id="h5-调用-android-端方法"><a href="#h5-调用-android-端方法" class="header-anchor">#</a> H5 调用 Android 端方法</h4> <p>安卓 addJavascriptInterface 注入。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 这里的对象名 androidJSBridge 是可以随意更改的，不固定。</span>
<span class="token function">addJavascriptInterface</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyJaveScriptInterface</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;androidJSBridge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// MyJaveScriptInterface类里面的方法</span>
<span class="token annotation punctuation">@JavascriptInterface</span>
<span class="token keyword">public</span> aliPay <span class="token punctuation">(</span><span class="token class-name">String</span> payJson<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  aliPayHelper<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span>payJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Android 在暴露给 H5端调用的方法能直接有返回值。</span>
  <span class="token keyword">return</span> <span class="token string">'success'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>H5 调用 Android 端暴露的方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这里的 androidJSBridge 是根据上面注册的名字来的。</span>
<span class="token comment">// js调用Android Native原生方法传递的参数必须是基本类型的数据，不能是引用数据类型，如果想传递引用类型需要使用JSON.stringify()。</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> window<span class="token punctuation">.</span>androidJSBridge<span class="token punctuation">.</span><span class="token function">aliPay</span><span class="token punctuation">(</span><span class="token string">&quot;string参数&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="h5-调用-ios-端方法"><a href="#h5-调用-ios-端方法" class="header-anchor">#</a> H5 调用 IOS 端方法</h4> <p>苹果 WKWebView scriptMessageHandler 注入</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span>  OC注册供JS调用的方法 <span class="token keyword">register</span>方法</span></span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>addScriptFunction <span class="token punctuation">{</span>
    self<span class="token punctuation">.</span>wkUserContentController <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>webView configuration<span class="token punctuation">]</span><span class="token punctuation">.</span>userContentController<span class="token punctuation">;</span>

    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>wkUserContentController addScriptMessageHandler<span class="token operator">:</span>self name<span class="token operator">:</span>@<span class="token string">&quot;register&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> <span class="token keyword">register</span>方法</span></span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token keyword">register</span><span class="token operator">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>body <span class="token punctuation">{</span>
     NSDictionary <span class="token operator">*</span>dict <span class="token operator">=</span> body<span class="token punctuation">;</span>
    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>userDefaults setObject<span class="token operator">:</span><span class="token punctuation">[</span>dict objectForKey<span class="token operator">:</span>@<span class="token string">&quot;password&quot;</span><span class="token punctuation">]</span> forKey<span class="token operator">:</span><span class="token punctuation">[</span>dict objectForKey<span class="token operator">:</span>@<span class="token string">&quot;username&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    不能直接返回结果，需要再次调用H5端的方法，告诉H5端注册成功。
    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>webView evaluateJavaScript<span class="token operator">:</span>@<span class="token string">&quot;registerCallback(true)&quot;</span> completionHandler<span class="token operator">:</span>nil<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ios 在暴露给 web 端调用的方法不能直接有返回值，如果需要有返回值需要再调用 web 端的方法来传递返回值。（也就是需要两步完成）。</p> <p>H5 调用 IOS 端暴露的方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 与android不同，ios这里的webkit.messageHandlers是固定写法，不能变。</span>
<span class="token comment">// 不传参数</span>
window<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">.</span>register<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 传递参数</span>
<span class="token comment">// 与android不同，ios这里的参数可以是基本类型和引用数据类型。</span>
window<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">.</span>register<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="android-与-ios-的双向通讯注意点"><a href="#android-与-ios-的双向通讯注意点" class="header-anchor">#</a> Android 与 IOS 的双向通讯注意点</h3> <ol><li>H5 端调用 Android 端方法使用<code>window.androidJSBridge.方法名(参数)</code>，这里的<code>androidJSBridge</code>名称不固定可自定义。而 H5 端调用 IOS 端方法固定写法为<code>window.webkit.messageHandlers.方法名.postMessage(参数)</code>。</li> <li>H5 端调用 Android 端方法传递的参数只能是基本数据类型，如果需要传递引用数据类型需要使用<code>JSON.stringfy()</code>处理。而 IOS 端既可以传递基本数据类型也可以传递引用数据类型。</li> <li>H5 端调用 Android 端方法可以直接有返回值。而 IOS 端不能直接有返回值。</li></ol> <h3 id="统一处理"><a href="#统一处理" class="header-anchor">#</a> 统一处理</h3> <p>看到这，宝宝们是不是又要问了，在 H5 端调用 Android 和 IOS 方法的方式都不同我们应该怎么区分当前是什么环境呢？别急，笔者早已准备好了方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 判断手机系统类型
 * @returns phoneSys
 */</span>
<span class="token keyword">function</span> <span class="token function">phoneSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> u <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> phoneSys <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">android|linux</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//安卓手机</span>
    phoneSys <span class="token operator">=</span> <span class="token string">&quot;android&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">iphone|ipad|ipod</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//苹果手机</span>
    phoneSys <span class="token operator">=</span> <span class="token string">&quot;ios&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;windows Phone&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//winphone手机</span>
    phoneSys <span class="token operator">=</span> <span class="token string">&quot;other&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> phoneSys<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用</span>
<span class="token comment">// 这里笔者只区分方法的调用方式，其实参数的类型和方法的返回值都需要处理。</span>
<span class="token keyword">function</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> phoneSys <span class="token operator">=</span> <span class="token function">phoneSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>webkit <span class="token operator">!=</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">&amp;&amp;</span> phoneSys <span class="token operator">==</span> <span class="token string">&quot;ios&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">.</span>call<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> jimiJS <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">&amp;&amp;</span> phoneSys <span class="token operator">==</span> <span class="token string">&quot;android&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">jimiJS</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="后记"><a href="#后记" class="header-anchor">#</a> 后记</h2> <p>本文为笔者个人学习笔记，如有谬误，还请告知，万分感谢！如果本文对你有所帮助，还请点个赞~~</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/H5/移动端H5网页开发常见问题汇总.html" class="prev">
        移动端H5网页开发常见问题汇总
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.30255e96.js" defer></script><script src="/assets/js/2.3fe5eade.js" defer></script><script src="/assets/js/18.380e1d86.js" defer></script>
  </body>
</html>
