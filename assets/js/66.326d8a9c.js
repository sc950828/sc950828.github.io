(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{422:function(t,s,a){"use strict";a.r(s);var e=a(44),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义"}},[t._v("#")]),t._v(" 定义")]),t._v(" "),a("p",[t._v("XSS(Cross Site Scripting ) 全称跨站点脚本攻击。")]),t._v(" "),a("p",[t._v("主要是本网站运行了来自其他网站的脚本。")]),t._v(" "),a("h2",{attrs:{id:"分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分类"}},[t._v("#")]),t._v(" 分类")]),t._v(" "),a("p",[t._v("XSS 常见的类型有反射型、存储型")]),t._v(" "),a("h3",{attrs:{id:"反射型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反射型"}},[t._v("#")]),t._v(" 反射型")]),t._v(" "),a("p",[t._v("主要是通过 url 传参把脚本传到服务器，服务器把参数回显到页面的时候运行了该脚本，导致黑客获取了用户信息或者登录态。")]),t._v(" "),a("p",[t._v("常见的是用户名的回显、等等。")]),t._v(" "),a("h3",{attrs:{id:"存储型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储型"}},[t._v("#")]),t._v(" 存储型")]),t._v(" "),a("p",[t._v("脚本被存储到了服务器数据库，用户获取数据的时候，从数据库读取出来显示到页面的时候运行了该脚本，导致黑客获取了用户信息或者登录态。")]),t._v(" "),a("p",[t._v("常见的是留言、博客文章等。")]),t._v(" "),a("h2",{attrs:{id:"注入方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注入方式"}},[t._v("#")]),t._v(" 注入方式")]),t._v(" "),a("p",[t._v("html 节点内容，也就是 innerHtml 的内容是动态的，所以有可能插入并运行脚本。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("#{content}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("html 属性，属性值是动态的，所以有可能运行脚本。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("#{image}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),a("p",[t._v("javascript 代码，在动态赋值的时候可能运行脚本。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#{data}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("富文本，富文本因为提交的是 html，所以也有可能插入脚本。")]),t._v(" "),a("h2",{attrs:{id:"防御方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防御方法"}},[t._v("#")]),t._v(" 防御方法")]),t._v(" "),a("h3",{attrs:{id:"自动防御"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动防御"}},[t._v("#")]),t._v(" 自动防御")]),t._v(" "),a("p",[t._v("Chrome 有自己的一套防御，但是只能防御部分反射型的攻击。也就是通过 url 传递脚本进行 html 节点内容 或 html 属性注入攻击的时候会被拦截，通过 javascript 代码或者富文本注入攻击并不会被拦截。这对反射性 xss 攻击很有效。")]),t._v(" "),a("p",[t._v("我们可以设置响应头 "),a("code",[t._v("X-XSS-Protection")]),t._v(" 为 0 来关闭自动防御。默认值是 1，也就是自动防御。")]),t._v(" "),a("h3",{attrs:{id:"html-转义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#html-转义"}},[t._v("#")]),t._v(" html 转义")]),t._v(" "),a("p",[t._v("html 转义主要是针对 html 节点内容的攻击和 html 属性攻击")]),t._v(" "),a("p",[t._v("针对 html 节点内容的攻击，我们可以在存储或者是显示的时候把"),a("code",[t._v("<")]),t._v(" "),a("code",[t._v(">")]),t._v("进行转义即可，比如"),a("code",[t._v("<")]),t._v("变为"),a("code",[t._v("&lt")]),t._v("， "),a("code",[t._v(">")]),t._v("变为 "),a("code",[t._v("&gt")])]),t._v(" "),a("p",[t._v("针对 html 属性攻击，我们可以把"),a("code",[t._v('"')]),t._v("转义为"),a("code",[t._v("&quto")]),t._v(" "),a("code",[t._v("'")]),t._v("转义为"),a("code",[t._v("&apos")])]),t._v(" "),a("h3",{attrs:{id:"js-转义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js-转义"}},[t._v("#")]),t._v(" js 转义")]),t._v(" "),a("p",[t._v("针对 javascript 代码攻击我们可以把"),a("code",[t._v('"')]),t._v("转义为"),a("code",[t._v('\\\\"')]),t._v(" "),a("code",[t._v("'")]),t._v("转义为"),a("code",[t._v("\\\\'")])]),t._v(" "),a("h3",{attrs:{id:"过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#过滤"}},[t._v("#")]),t._v(" 过滤")]),t._v(" "),a("p",[t._v("针对富文本攻击我们可以通过过滤来防止攻击。过滤有两种方案，白名单或者黑名单。")]),t._v(" "),a("p",[t._v("黑名单方案过滤有危险的标签，比如")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 替换script标签")]),t._v("\nhtml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("<\\s*\\/?script\\s*>")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("白名单方案就是只有自己想要的标签才能保存，不在白名单里面的标签过滤掉。")]),t._v(" "),a("ul",[a("li",[t._v("我们可以利用"),a("a",{attrs:{href:"https://github.com/cheeriojs/cheerio",target:"_blank",rel:"noopener noreferrer"}},[t._v("cheerio"),a("OutboundLink")],1),t._v("库解析 html 文本，然后自定义过滤。")]),t._v(" "),a("li",[t._v("我们还可以使用别人写好的库 "),a("a",{attrs:{href:"https://github.com/leizongmin/js-xss",target:"_blank",rel:"noopener noreferrer"}},[t._v("xss"),a("OutboundLink")],1),t._v("来直接使用。")])]),t._v(" "),a("h3",{attrs:{id:"http-only"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-only"}},[t._v("#")]),t._v(" http-only")]),t._v(" "),a("p",[t._v("如果只针对 cookie，我们可以设置 cookie 的 http-only 属性为 true，这样 cookie 就不能通过 js 操作了，这样就算别人 XSS 攻击也拿不到我们的 cookie 了。")]),t._v(" "),a("h3",{attrs:{id:"csp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#csp"}},[t._v("#")]),t._v(" CSP")]),t._v(" "),a("p",[t._v("CSP 全称 Content Security Policy，是内容安全策略，主要用于指定哪些内容可执行。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("child-src、content-src、default-src")])]),t._v(" "),a("li",[a("p",[t._v("font-src、frame-src、img-src")])]),t._v(" "),a("li",[a("p",[t._v("manifest-src、media-src、object-src")])]),t._v(" "),a("li",[a("p",[t._v("scritp-src、style-src、worker-src")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("<host-source>")]),t._v("、"),a("code",[t._v("<scheme-source>")]),t._v("、'self'")])]),t._v(" "),a("li",[a("p",[t._v("'unsafe-inline'、'unsafe-eval'、'none'")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("nonce-<base64-value>")]),t._v("、"),a("code",[t._v("<hash-source>")])])]),t._v(" "),a("li",[a("p",[t._v("'strict-dynamic'")])])]),t._v(" "),a("p",[t._v("两种方法可以启用 CSP。")]),t._v(" "),a("p",[t._v("一种是通过 HTTP 头信息的 Content-Security-Policy 的字段。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Content-Security-Policy: script-src 'self'; object-src 'none';\nstyle-src cdn.example.org third-party.org;\n")])])]),a("p",[t._v("另一种是通过网页的"),a("code",[t._v("<meta>")]),t._v("标签。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Content-Security-Policy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("script-src "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("; object-src "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("; style-src cdn.example.org third-party.org;"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),a("p",[t._v("更多详情可以参考"),a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/09/csp.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("阮一峰老师的 Content Security Policy 入门教程"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);