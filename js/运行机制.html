<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js 的运行机制 | 苏纯的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/randy.jpg">
    <meta name="description" content="前端路上的点点滴滴">
    <meta name="keywords" content="苏纯，苏纯的博客，苏纯的个人博客">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.e65bc892.js" as="script"><link rel="preload" href="/assets/js/2.85e80f7c.js" as="script"><link rel="preload" href="/assets/js/39.83d8f1a2.js" as="script"><link rel="prefetch" href="/assets/js/10.2cc7c1b7.js"><link rel="prefetch" href="/assets/js/100.503d6824.js"><link rel="prefetch" href="/assets/js/101.467351b9.js"><link rel="prefetch" href="/assets/js/102.85da88e3.js"><link rel="prefetch" href="/assets/js/103.e80b0a30.js"><link rel="prefetch" href="/assets/js/104.76ce46e4.js"><link rel="prefetch" href="/assets/js/105.b9551c64.js"><link rel="prefetch" href="/assets/js/106.1046dc50.js"><link rel="prefetch" href="/assets/js/107.3711410c.js"><link rel="prefetch" href="/assets/js/108.1baa70fb.js"><link rel="prefetch" href="/assets/js/11.5576952a.js"><link rel="prefetch" href="/assets/js/12.cbc6050f.js"><link rel="prefetch" href="/assets/js/13.3eede3b1.js"><link rel="prefetch" href="/assets/js/14.e2bc046e.js"><link rel="prefetch" href="/assets/js/15.94510f86.js"><link rel="prefetch" href="/assets/js/16.51993914.js"><link rel="prefetch" href="/assets/js/17.fdab191d.js"><link rel="prefetch" href="/assets/js/18.6952ef03.js"><link rel="prefetch" href="/assets/js/19.66a682be.js"><link rel="prefetch" href="/assets/js/20.f1e52e83.js"><link rel="prefetch" href="/assets/js/21.d299cc10.js"><link rel="prefetch" href="/assets/js/22.d045f903.js"><link rel="prefetch" href="/assets/js/23.4b8706c2.js"><link rel="prefetch" href="/assets/js/24.d828a160.js"><link rel="prefetch" href="/assets/js/25.9207a2db.js"><link rel="prefetch" href="/assets/js/26.4dfe712f.js"><link rel="prefetch" href="/assets/js/27.5198e671.js"><link rel="prefetch" href="/assets/js/28.9fb3d91b.js"><link rel="prefetch" href="/assets/js/29.48dd22f8.js"><link rel="prefetch" href="/assets/js/3.c5a6cd19.js"><link rel="prefetch" href="/assets/js/30.604534e0.js"><link rel="prefetch" href="/assets/js/31.0670a7d6.js"><link rel="prefetch" href="/assets/js/32.855f67fe.js"><link rel="prefetch" href="/assets/js/33.b79b25bf.js"><link rel="prefetch" href="/assets/js/34.c70a6892.js"><link rel="prefetch" href="/assets/js/35.74e0fda4.js"><link rel="prefetch" href="/assets/js/36.2f9de622.js"><link rel="prefetch" href="/assets/js/37.2b0a90ff.js"><link rel="prefetch" href="/assets/js/38.88bba1cc.js"><link rel="prefetch" href="/assets/js/4.bc4e02d5.js"><link rel="prefetch" href="/assets/js/40.5f845ce9.js"><link rel="prefetch" href="/assets/js/41.9e101dea.js"><link rel="prefetch" href="/assets/js/42.fdd55e63.js"><link rel="prefetch" href="/assets/js/43.e394ed90.js"><link rel="prefetch" href="/assets/js/44.a36447cd.js"><link rel="prefetch" href="/assets/js/45.a2637689.js"><link rel="prefetch" href="/assets/js/46.4a4b1a79.js"><link rel="prefetch" href="/assets/js/47.02b87045.js"><link rel="prefetch" href="/assets/js/48.a633a822.js"><link rel="prefetch" href="/assets/js/49.4fba2abe.js"><link rel="prefetch" href="/assets/js/5.416fc629.js"><link rel="prefetch" href="/assets/js/50.ece1958a.js"><link rel="prefetch" href="/assets/js/51.08838220.js"><link rel="prefetch" href="/assets/js/52.2c97c109.js"><link rel="prefetch" href="/assets/js/53.d9bed3cc.js"><link rel="prefetch" href="/assets/js/54.f14f894f.js"><link rel="prefetch" href="/assets/js/55.f86d3182.js"><link rel="prefetch" href="/assets/js/56.967c5b4c.js"><link rel="prefetch" href="/assets/js/57.ee31adeb.js"><link rel="prefetch" href="/assets/js/58.e4f97fc3.js"><link rel="prefetch" href="/assets/js/59.ba87c446.js"><link rel="prefetch" href="/assets/js/6.3003f5cf.js"><link rel="prefetch" href="/assets/js/60.0fd687b2.js"><link rel="prefetch" href="/assets/js/61.14c29aa8.js"><link rel="prefetch" href="/assets/js/62.02ed4a84.js"><link rel="prefetch" href="/assets/js/63.4f244790.js"><link rel="prefetch" href="/assets/js/64.90f95442.js"><link rel="prefetch" href="/assets/js/65.6fcecaac.js"><link rel="prefetch" href="/assets/js/66.30dc9e49.js"><link rel="prefetch" href="/assets/js/67.30e77409.js"><link rel="prefetch" href="/assets/js/68.1ae103d0.js"><link rel="prefetch" href="/assets/js/69.2bb1b3ba.js"><link rel="prefetch" href="/assets/js/7.bbe000a8.js"><link rel="prefetch" href="/assets/js/70.e1e9078a.js"><link rel="prefetch" href="/assets/js/71.fb3fb6bc.js"><link rel="prefetch" href="/assets/js/72.d2af19fa.js"><link rel="prefetch" href="/assets/js/73.78deac33.js"><link rel="prefetch" href="/assets/js/74.77e5798c.js"><link rel="prefetch" href="/assets/js/75.74ccbd2e.js"><link rel="prefetch" href="/assets/js/76.0c18d1d7.js"><link rel="prefetch" href="/assets/js/77.b6984bdc.js"><link rel="prefetch" href="/assets/js/78.469bdbcd.js"><link rel="prefetch" href="/assets/js/79.cb7728c0.js"><link rel="prefetch" href="/assets/js/8.3886c466.js"><link rel="prefetch" href="/assets/js/80.c0406a4b.js"><link rel="prefetch" href="/assets/js/81.1268ffd3.js"><link rel="prefetch" href="/assets/js/82.1c9fd783.js"><link rel="prefetch" href="/assets/js/83.49eb541a.js"><link rel="prefetch" href="/assets/js/84.3a81bdc3.js"><link rel="prefetch" href="/assets/js/85.9a3ca1b0.js"><link rel="prefetch" href="/assets/js/86.50d7abf5.js"><link rel="prefetch" href="/assets/js/87.c857b6fb.js"><link rel="prefetch" href="/assets/js/88.727da12b.js"><link rel="prefetch" href="/assets/js/89.0645d794.js"><link rel="prefetch" href="/assets/js/9.ca7f7cc1.js"><link rel="prefetch" href="/assets/js/90.496a5ff3.js"><link rel="prefetch" href="/assets/js/91.1ed206dd.js"><link rel="prefetch" href="/assets/js/92.ca50f394.js"><link rel="prefetch" href="/assets/js/93.32e5d343.js"><link rel="prefetch" href="/assets/js/94.d217474c.js"><link rel="prefetch" href="/assets/js/95.9cda0ec7.js"><link rel="prefetch" href="/assets/js/96.652ba2c1.js"><link rel="prefetch" href="/assets/js/97.77aee651.js"><link rel="prefetch" href="/assets/js/98.05d8dd2a.js"><link rel="prefetch" href="/assets/js/99.dec73291.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">苏纯的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide.html" class="nav-link">
  导航
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人收藏" class="dropdown-title"><span class="title">个人收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人收藏" class="mobile-dropdown-title"><span class="title">个人收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/个人收藏/好文章.html" class="nav-link">
  好文章
</a></li><li class="dropdown-item"><!----> <a href="/个人收藏/面试好文章.html" class="nav-link">
  面试好文章
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/sc950828" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide.html" class="nav-link">
  导航
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人收藏" class="dropdown-title"><span class="title">个人收藏</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人收藏" class="mobile-dropdown-title"><span class="title">个人收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/个人收藏/好文章.html" class="nav-link">
  好文章
</a></li><li class="dropdown-item"><!----> <a href="/个人收藏/面试好文章.html" class="nav-link">
  面试好文章
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/sc950828" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/html5" class="sidebar-heading clickable"><span>html5</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/css3" class="sidebar-heading clickable"><span>css3</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/js" class="sidebar-heading clickable router-link-active open"><span>js</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/数据类型.html" class="sidebar-link">数据类型</a></li><li><a href="/js/object.html" class="sidebar-link">Object</a></li><li><a href="/js/DOM.html" class="sidebar-link">DOM</a></li><li><a href="/js/BOM.html" class="sidebar-link">BOM</a></li><li><a href="/js/this.html" class="sidebar-link">this</a></li><li><a href="/js/继承.html" class="sidebar-link">继承</a></li><li><a href="/js/原型.html" class="sidebar-link">原型</a></li><li><a href="/js/闭包.html" class="sidebar-link">闭包</a></li><li><a href="/js/拷贝.html" class="sidebar-link">拷贝</a></li><li><a href="/js/事件.html" class="sidebar-link">事件</a></li><li><a href="/js/运行机制.html" class="active sidebar-link">运行机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/运行机制.html#js-的运行机制" class="sidebar-link">js 的运行机制</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#进程与线程" class="sidebar-link">进程与线程</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#什么是线程" class="sidebar-link">什么是线程?</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#单线程与多线程" class="sidebar-link">单线程与多线程</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#进程和线程的关系" class="sidebar-link">进程和线程的关系</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#js-是单线程还是多线程" class="sidebar-link">js 是单线程还是多线程？</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#js-为什么是单线程" class="sidebar-link">js 为什么是单线程？</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#什么是执行上下文" class="sidebar-link">什么是执行上下文？</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#javascript-中有三种执行上下文。" class="sidebar-link">JavaScript 中有三种执行上下文。</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#什么是执行栈" class="sidebar-link">什么是执行栈？</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#简单总结-js-执行流程" class="sidebar-link">简单总结 js 执行流程</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#同步和异步" class="sidebar-link">同步和异步</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#异步初探" class="sidebar-link">异步初探</a></li><li class="sidebar-sub-header"><a href="/js/运行机制.html#异步进阶" class="sidebar-link">异步进阶</a></li></ul></li><li><a href="/js/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/js/防抖与节流.html" class="sidebar-link">防抖与节流</a></li><li><a href="/js/请求.html" class="sidebar-link">请求</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/ts" class="sidebar-heading clickable"><span>ts</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/vue" class="sidebar-heading clickable"><span>vue</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/react" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/构建" class="sidebar-heading clickable"><span>构建</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/web安全" class="sidebar-heading clickable"><span>web安全</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/性能优化" class="sidebar-heading clickable"><span>性能优化</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/app" class="sidebar-heading clickable"><span>app</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/git" class="sidebar-heading clickable"><span>git</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/计算机" class="sidebar-heading clickable"><span>计算机</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/服务器" class="sidebar-heading clickable"><span>服务器</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="js-的运行机制"><a href="#js-的运行机制" class="header-anchor">#</a> js 的运行机制</h2> <p>本文大致分为以下这些的步骤来帮助我们由浅入深更加清晰的了解 JS 运行机制</p> <ol><li>了解进程和线程的概念</li> <li>了解 js 中的执行栈和执行上下文</li> <li>了解 js 中的同步和异步 宏任务微任务</li> <li>了解 js 中的事件循环</li> <li>通过例子验证我们的总结</li></ol> <h2 id="进程与线程"><a href="#进程与线程" class="header-anchor">#</a> 进程与线程</h2> <h3 id="什么是进程"><a href="#什么是进程" class="header-anchor">#</a> 什么是进程?</h3> <p>官网说法，进程是 CPU 资源分配的最小单位</p> <p>通俗的讲就是运行中的程序，我将它理解为一个可以独立运行且拥有自己的资源空间的任务程序，比如微信 qq</p> <h2 id="什么是线程"><a href="#什么是线程" class="header-anchor">#</a> 什么是线程?</h2> <p>官网说法，线程是 CPU 调度的最小单位</p> <p>线程是建立在进程的基础上的一次程序运行单位，通俗点解释线程就是程序中的一个执行流，一个进程可以有多个线程</p> <h2 id="单线程与多线程"><a href="#单线程与多线程" class="header-anchor">#</a> 单线程与多线程</h2> <h3 id="什么是单线程-什么是多线程"><a href="#什么是单线程-什么是多线程" class="header-anchor">#</a> 什么是单线程?什么是多线程？</h3> <p>一个进程中只有一个执行流称作单线程，即程序执行时，所走的程序路径按照连续顺序排下来，前面的必须处理好，后面的 才会执行</p> <p>一个进程中有多个执行流称作多线程，即在一个程序中可以同时运行多个不同的线程来执行不同的任务，也就是说允许单个程序创建多个并行执行的线程来完成各自的任务</p> <h2 id="进程和线程的关系"><a href="#进程和线程的关系" class="header-anchor">#</a> 进程和线程的关系</h2> <p>一个进程由一个或多个线程组成，线程可以理解为是一个进程中代码的不同执行路线。比如我可以打开 qq 音乐一边听歌一边下载。</p> <h2 id="js-是单线程还是多线程"><a href="#js-是单线程还是多线程" class="header-anchor">#</a> js 是单线程还是多线程？</h2> <p>单线程</p> <h2 id="js-为什么是单线程"><a href="#js-为什么是单线程" class="header-anchor">#</a> js 为什么是单线程？</h2> <p>作为浏览器脚本语言，JavaScript 的主要用途是与用户互动，以及操作 DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定 JavaScript 同时有两个线程，一个线程在某个 DOM 节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？这样就要引入锁的概念了，更复杂了。</p> <h2 id="什么是执行上下文"><a href="#什么是执行上下文" class="header-anchor">#</a> 什么是执行上下文？</h2> <p>执行上下文是 JavaScript 代码的环境的抽象概念。每当 Javascript 代码在运行的时候，它都是在执行上下文中运行。</p> <h2 id="javascript-中有三种执行上下文。"><a href="#javascript-中有三种执行上下文。" class="header-anchor">#</a> JavaScript 中有三种执行上下文。</h2> <p>全局执行上下文 这是默认或者说基础的上下文，任何不在函数内部的代码都在全局上下文中。它会执行两件事：创建一个全局的 window 对象（浏览器的情况下），并且设置 this 的值等于这个全局对象。一个程序中只会有一个全局执行上下文。</p> <p>函数执行上下文 每当一个函数被调用时, 都会为该函数创建一个新的上下文。每个函数都有它自己的执行上下文，不过是在函数被调用时创建的。函数上下文可以有任意多个。每当一个新的执行上下文被创建，它会按定义的顺序（将在后文讨论）执行一系列步骤。</p> <p>Eval 函数执行上下文 — 执行在 eval 函数内部的代码也会有它属于自己的执行上下文，不常用我们不讨论。</p> <h2 id="什么是执行栈"><a href="#什么是执行栈" class="header-anchor">#</a> 什么是执行栈？</h2> <p>用来存储代码运行时创建的执行上下文。</p> <p>当 JavaScript 引擎第一次遇到你的脚本时，它会创建一个全局的执行上下文并且压入当前执行栈。每当引擎遇到一个函数调用，它会为该函数创建一个新的执行上下文并压入栈的顶部。</p> <p>js 引擎会执行那些位于栈顶的执行上下文。当该执行上下文执行结束时，执行上下文从栈中弹出，控制流程到达当前栈中的下一个执行上下文。</p> <h3 id="下面的代码会输出什么-会创建怎样的执行上下文呢"><a href="#下面的代码会输出什么-会创建怎样的执行上下文呢" class="header-anchor">#</a> 下面的代码会输出什么？会创建怎样的执行上下文呢？</h3> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Global Execution Context start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;first function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Again first function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;second function&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Global Execution Context end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://xiaosu72.oss-cn-shanghai.aliyuncs.com/my-blog/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87.png" alt="image"></p> <h2 id="简单总结-js-执行流程"><a href="#简单总结-js-执行流程" class="header-anchor">#</a> 简单总结 js 执行流程</h2> <p>在执行一段代码时，JS 引擎会首先创建一个执行栈，用来存放执行上下文。</p> <p>然后 JS 引擎会创建一个全局执行上下文，并 push 到执行栈中, 这个过程 JS 引擎会为这段代码中所有变量分配内存并赋一个初始值（undefined），在创建完成后，JS 引擎会进入执行阶段，这个过程 JS 引擎会逐行的执行代码，即为之前分配好内存的变量逐个赋值(真实值)。</p> <p>如果这段代码中存在 function 的调用，那么 JS 引擎会创建一个函数执行上下文，并 push 到执行栈中，其创建和执行过程跟全局执行上下文一样。</p> <h2 id="同步和异步"><a href="#同步和异步" class="header-anchor">#</a> 同步和异步</h2> <p>同步任务指的是，在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务；</p> <p>异步任务指的是，不进入主线程、而进入&quot;任务队列&quot;的任务(任务队列中的任务与主线程并列执行)，只有当主线程空闲了并且&quot;任务队列&quot;通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。满足先进先出规则。</p> <h2 id="异步初探"><a href="#异步初探" class="header-anchor">#</a> 异步初探</h2> <p>js 是单线程的 到底是怎么处理异步的呢？</p> <p>比如我们有个定时器，有个 ajax 请求，js 是停止运行了等待结果还是继续运行？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">setTimeoutFun</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是定时器回调&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token function-variable function">httpFun</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">myJson</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myJson<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 同步任务</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是同步任务1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 异步定时任务</span>
<span class="token function">setTimeoutFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 异步http请求任务</span>
<span class="token function">httpFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 同步任务</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是同步任务2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="http://xiaosu72.oss-cn-shanghai.aliyuncs.com/my-blog/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF.png" alt="image"></p> <p>总结</p> <p>同步和异步任务分别进入不同的执行&quot;场所&quot;，同步的进入主线程，只有前一个任务执行完毕，才能执行后一个任务。异步任务不进入主线程而是进入 Event Table 并注册函数。</p> <p>当指定的事情完成时，Event Table 会将这个函数移入 Event Queue。</p> <p>主线程内的任务执行完毕为空，会去 Event Queue 读取对应的函数，进入主线程执行。</p> <p>上述过程会不断重复，也就是常说的 Event Loop(事件循环)。</p> <h2 id="异步进阶"><a href="#异步进阶" class="header-anchor">#</a> 异步进阶</h2> <p>来看一下这个例子 会输出啥</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 同步任务1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是同步任务1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 异步任务</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是异步任务定时器&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 异步任务</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;new promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 同步任务2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我是同步任务2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>所以异步有宏任务(macrotask) 和 微任务(microtask)</p> <p>常见的宏任务</p> <p>主代码块
setTimeout
setInterval</p> <p>常见微任务</p> <p>process.nextTick() Node 才有
Promise.then()</p> <p><img src="http://xiaosu72.oss-cn-shanghai.aliyuncs.com/my-blog/%E5%AE%8C%E6%95%B4%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF.png" alt="image"></p> <p>总结</p> <p>首先，整体的 script(作为第一个宏任务)开始执行的时候，会把所有代码分为同步任务、异步任务两部分</p> <p>同步任务会直接进入主线程依次执行</p> <p>异步任务会再分为宏任务和微任务</p> <p>宏任务进入到 Event Table 中，并在里面注册回调函数，每当指定的事件完成时，Event Table 会将这个函数移到 Event Queue 中</p> <p>微任务也会进入到另一个 Event Table 中，并在里面注册回调函数，每当指定的事件完成时，Event Table 会将这个函数移到 Event Queue 中</p> <p>当主线程内的任务执行完毕，主线程为空时，会检查微任务的 Event Queue，如果有任务，就全部执行，如果没有就执行下一个宏任务</p> <p>上述过程会不断重复，这就是 Event Loop 事件循环</p> <h3 id="例子"><a href="#例子" class="header-anchor">#</a> 例子</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// timer1</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// timer2</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// timer3</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// timer4</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js/事件.html" class="prev">
        事件
      </a></span> <span class="next"><a href="/js/垃圾回收.html">
        垃圾回收
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e65bc892.js" defer></script><script src="/assets/js/2.85e80f7c.js" defer></script><script src="/assets/js/39.83d8f1a2.js" defer></script>
  </body>
</html>
